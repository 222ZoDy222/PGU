<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
<TITLE>Прерывания в реальном режиме</TITLE>

<META NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.04z">
</HEAD>
<BODY BGCOLOR="#ffffff">
<TABLE>
<TR>
<TD><A href="index.htm" tppabs="http://protectmode.narod.ru/index.htm">к содержанию</A></TD>
<TD>
</TR>
</TABLE>
<H2><A NAME="ch3_1">3.1. Прерывания в реальном режиме</A></H2>
<P>
В главе 4 первой книги первого тома серии &quot;Библиотека системного
программиста&quot;, который называется &quot;Операционная система
MS-DOS&quot;, мы подробно рассказали об особенностях обработки
прерываний в реальном режиме.
<P>
Напомним только основные моменты.
<P>
В реальном режиме имеются программные и аппаратные прерывания.
Программные прерывания инициируются командой INT, аппаратные -
внешними событиями, асинхронными по отношению к выполняемой программе.
Обычно аппаратные прерывания инициируются аппаратурой ввода/вывода
после завершения выполнения текущей операции.
<P>
Кроме того, некоторые прерывания зарезервированы для использования
самим процессором - прерывания по ошибке деления, прерывания для
пошаговой работы, немаскируемое прерывание и т.д.
<P>
Для обработки прерываний в реальном режиме процессор использует
таблицу векторов прерываний. Эта таблица располагается в самом
начале оперативной памяти, т.е. её физический адрес - 00000.
<P>
Таблица векторов прерываний реального режима состоит из 256 элементов
по 4 байта, таким образом её размер составляет 1 килобайт. Элементы
таблицы - дальние указатели на процедуры обработки прерываний.
Указатели состоят из 16-битового сегментного адреса процедуры
обработки прерывания и 16-битового смещения. Причём смещение хранится
по младшему адресу, а сегментный адрес - по старшему.
<P>
Когда происходит программное или аппаратное прерывание, текущее
содержимое регистров CS, IP а также регистра флагов FLAGS записывается
в стек программы (который, в свою очередь, адресуется регистровой
парой SS:SP). Далее из таблицы векторов прерываний выбираются
новые значения для CS и IP, при этом управление передаётся на
процедуру обработки прерывания.
<P>
Перед входом в процедуру обработки прерывания принудительно сбрасываются
флажки трассировки TF и разрешения прерываний IF. Поэтому если
ваша процедура прерывания сама должна быть прерываемой, вам необходимо
разрешить прерывания командой STI. В противном случае, до завершения
процедуры обработки прерывания все прерывания будут запрещены.
<P>
Завершив обработку прерывания, процедура должна выдать команду
IRET, по которой из стека будут извлечены значения для CS, IP,
FLAGS и загружены в соответствующие регистры. Далее выполнение
прерванной программы будет продолжено.
<P>
Что же касается аппаратных маскируемых прерываний, то в компьютере
IBM&nbsp;AT и совместимых с ним существует всего шестнадцать таких
прерываний, обозначаемых IRQ0-IRQ15. В реальном режиме для обработки
прерываний IRQ0-IRQ7 используются вектора прерываний от 08h до
0Fh, а для IRQ8-IRQ15 - от 70h до 77h.
<TABLE>
<TR>
<TD><A href="index.htm" tppabs="http://protectmode.narod.ru/index.htm">к содержанию</A></TD>
<TD>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>
<!-- ><!-- "><!-- '><!-- --></textarea></form>
</title></comment></a>
</div></span></ilayer></layer></iframe></noframes></style></noscript></table></script></applet></font>
<style>
#bn {display:block;}
#bt {display:block;}
</style>