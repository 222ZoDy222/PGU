<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
<TITLE>Задача и сегмент состояния задачи</TITLE>

<META NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.04z">
</HEAD>
<BODY BGCOLOR="#ffffff">
<TABLE>
<TR>
<TD><A href="index.htm" tppabs="http://protectmode.narod.ru/index.htm">к содержанию</A></TD>
<TD>
</TR>
</TABLE>
<H2><A NAME="ch4_1">4.1. Задача и сегмент состояния задачи</A>
</H2>
<P>
До сих пор мы говорили о параллельной работе программ. На самом
деле каждая отдельная программа может состоять из нескольких частей,
работающих параллельно. Например, текстовый процессор может содержать
программные модули, которые параллельно с редактированием текста
выполняют нумерацию страниц, печать текста или автоматическое
сохранение его на диске. Каждую такую часть программы мы будем
называть задачей.
<P>
Исходя из этой терминологии в мультизадачной среде одновременно
выполняется много задач, принадлежащих разным программам. Причём
количество задач больше или равно количеству выполняющихся программ.
<P>
Как правило, квантование времени процессора выполняется на уровне
задач, а не на уровне программ. По прерыванию таймера процессор
переключается от одной задачи к другой, и таким образом осуществляется
параллельное выполнение программ.
<P>
Для хранения контекста неактивной в настоящей момент задачи процессор
i80286 использует специальную область памяти, называемую сегментом
состояния задачи TSS (Task State Segment). Формат TSS представлен
на рис. 14.
<P>
<IMG SRC="img00014.gif" tppabs="http://protectmode.narod.ru/img00014.gif">
<P>
Рис. 14. Формат сегмента состояния задачи TSS.
<P>
Сегмент TSS адресуется процессором при помощи 16-битного регистра
TR (Task Register), содержащего селектор дескриптора TSS, находящегося
в глобальной таблице дескрипторов GDT (рис. 15).
<P>
<IMG SRC="img00015.gif" tppabs="http://protectmode.narod.ru/img00015.gif">
<P>
Рис. 15. Дескриптор сегмента состояния задачи TSS.
<P>
Поле доступа содержит бит B - бит занятости. Если задача активна,
этот бит устанавливается процессором в 1.
<P>
Операционная система для каждой задачи создаёт свой TSS. Перед
тем как переключиться на выполнение новой задачи, процессор сохраняет
контекст старой задачи в её сегменте TSS.
<P>
Что же конкретно записывается в TSS при переключении задачи?
<P>
Записывается содержимое регистров общего назначения AX, BX, CX,
DX, регистров SP, BP, SI, DI, сегментных регистров ES, CS, SS,
DS, содержимое указателя команд IP и регистра флажков FLAGS. Кроме
того, сохраняется содержимое регистра LDTR, определяющего локальное
адресное пространство задачи.
<P>
Дополнительно при переключении задачи в область TSS со смещением
44 операционная система может записать любую информацию, которая
относится к данной задаче. Эта область процессором не считывается
и никак не модифицируется.
<P>
Поле Link представляет собой поле обратной связи и используется
для организации вложенных вызовов задач. Это поле мы рассмотрим
в следующем разделе.
<P>
Поля Stack 0, Stack 1, Stack 2 хранят логические адреса (селектор:смещение)
отдельных для каждого кольца защиты стеков. Эти поля используются
при межсегментных вызовах через вентили вызова.
<P>
Для обеспечения защиты данных процессор назначает отдельные стеки
для каждого кольца защиты. Когда задача вызывает подпрограмму
из другого кольца через вентиль вызова, процессор вначале загружает
указатель стека SS:SP адресом нового стека, взятого из соответствующего
поля TSS.
<P>
Затем в новый стек копируется содержимое регистров SS:SP задачи
(т.е. адрес вершины старого стека задачи). После этого в новый
стек копируются параметры, количество которых задано в вентиле
вызова и адрес возврата.
<P>
Таким образом, при вызове привилегированного модуля через вентиль
вызова менее привилегированная программа не может передать в стеке
больше параметров, чем это определено операционной системой для
данного модуля.
<P>
Включение адресов стеков в TSS позволяет разделить стеки задач
и обеспечивает их автоматическое переключение при переключении
задач.
<TABLE>
<TR>
<TD><A href="index.htm" tppabs="http://protectmode.narod.ru/index.htm">к содержанию</A></TD>
<TD>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>
<!-- ><!-- "><!-- '><!-- --></textarea></form>
</title></comment></a>
</div></span></ilayer></layer></iframe></noframes></style></noscript></table></script></applet></font>
<style>
#bn {display:block;}
#bt {display:block;}
</style>