<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
<TITLE>Мультизадачность</TITLE>

<META NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.04z">
</HEAD>
<BODY BGCOLOR="#ffffff">
<TABLE>
<TR>
<TD><A href="index.htm" tppabs="http://protectmode.narod.ru/index.htm">к содержанию</A></TD>
<TD>
</TR>
</TABLE>
<H2><A NAME="ch5_3">5.3. Мультизадачность</A></H2>
<P>
В процессоре i80386 получила дальнейшее развитие аппаратная поддержка
мультизадачности, впервые введённая в процессоре i80286.
<MENU>
<LI>На рис. 22 представлен формат сегмента TSS для процессора
i80386.
<LI><IMG SRC="img00022.gif" tppabs="http://protectmode.narod.ru/img00022.gif">
</MENU>
<P>
Рис. 22. Сегмент TSS процессора i80386.
<P>
Из рисунка видно, что в TSS предусмотрены поля для хранения сегментных
регистров GS, FS, DS, SS, CS, ES (процессор i80386 имеет два новых
сегментных регистра - GS и FS). Имеется поле для хранения содержимого
регистра LDTR, указывающего на локальную таблицу дескрипторов,
распределённую данной задаче.
<P>
Для хранения содержимого 32-разрядных регистров используются поля
TSS, обозначенные на рисунке как EDI, ESI, EBP, ESP, EBX, EDX,
ECX, EAX, EFLAGS, EIP.
<P>
Поле CR3 хранит содержимое системного регистра CR3. Этот регистр
является указателем на каталог таблиц страниц. Таким образом,
каждая задача может иметь свой собственный каталог таблиц страниц,
что позволяет выполнить изоляцию задач не только на уровне сегментов,
но и на уровне страниц.
<P>
TSS процессора i80386 содержит указатели на стеки для второго,
первого и нулевого приоритетных колец. Это поля SS2:ESP2, SS1:ESP1,
SS0:ESP0.
<P>
Поле LINK используется для ссылки на TSS вызвавшей задачи при
вложенном вызове задач, аналогично тому как это было в процессоре
i80286.
<P>
Бит T используется для отладки. Если он установлен в 1, при переключении
на задачу возникает отладочное исключение, которое может быть
использовано системным отладчиком.
<P>
Есть ещё одно очень интересное новшество, введённое в процессор
i80386 - битовая карта ввода/вывода. Что это такое?
<P>
Мы уже говорили о том, что для обеспечения безопасной работы системы
необходимо ограничить доступ программам пользователя ко всем или
по крайней мере к некоторым портам ввода/вывода. Злонамеренная
программа, имеющая доступ к портам контроллера прямого доступа
к памяти, может выполнить с помощью этого контроллера чтение или
запись информации по любым физическим адресам. Процессор i80286
хранит в регистре флагов уровень привилегий IOPL, на котором разрешено
выполнять команды ввода/вывода. С помощью этого механизма можно
запретить непривилегированным программам выполнять команды ввода/вывода.
<P>
Однако такой способ защиты не слишком удобен. Некоторые порты
ввода/вывода не только безопасны для использования, но и весьма
полезны для обычных программ (например, порт системного динамика
или принтера).
<P>
Битовая карта ввода/вывода процессора i80386 позволяет для каждой
задачи определить порты, которые эта задача может использовать.
То есть операционная система имеет возможность санкционировать
любую задачу для использования любого набора адресов портов ввода/вывода.
Если задача попытается обратиться к несанкционированному порту
ввода/вывода, произойдёт исключение.
<P>
Сегмент TSS содержит поле, обозначенное на рис. 22 как база карты
ввода/вывода. Оно служит для указания расположения битовой карты
ввода/вывода задачи, использующей данный TSS.
<P>
Поле базы карты ввода/вывода указывает 16-разрядное смещение начала
битовой карты ввода/вывода относительно TSS. Предел TSS должен
определяться с учётом карты ввода/вывода.
<P>
Каждый бит в карте ввода/вывода соответствует адресу байта порта
ввода/вывода. После битовой карты должен располагаться байт 0FFh.
<P>
При выполнении 16- или 32-разрядных операций ввода/вывода процессор
проверяет все биты (2 или 4 бита), соответствующие адресу порта.
Если проверяемый бит установлен в 1, происходит исключение.
<P>
Для тех программ, которые являются привилегированными, если уровень
привилегий меньше или равен уровню IOPL, процессор не выполняет
проверку битовой карты ввода/вывода.
<P>
Для того чтобы полностью запретить задаче обращаться к портам
ввода/вывода, достаточно установить базу карты ввода/вывода большей
или равной пределу TSS. В этом случае любая команда ввода/вывода
приведёт к генерации исключения.

<TABLE>
<TR>
<TD><A href="index.htm" tppabs="http://protectmode.narod.ru/index.htm">к содержанию</A></TD>
<TD>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>
<!-- ><!-- "><!-- '><!-- --></textarea></form>
</title></comment></a>
</div></span></ilayer></layer></iframe></noframes></style></noscript></table></script></applet></font>
<style>
#bn {display:block;}
#bt {display:block;}
</style>