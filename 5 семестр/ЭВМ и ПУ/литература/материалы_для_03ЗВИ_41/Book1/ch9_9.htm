<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1251">
<TITLE>Защищённый режим процессоров Intel 80286/80386/80486</TITLE>

<META NAME="GENERATOR" CONTENT="Internet Assistant for Microsoft Word 2.04z">
</HEAD>
<BODY BGCOLOR="#ffffff">
<TABLE>
<TR>
<TD><A href="index.htm" tppabs="http://protectmode.narod.ru/index.htm">к содержанию</A></TD>
<TD>
</TR>
</TABLE>
<H2><A NAME="ch9_9">9.9. Защита программ от отладки</A></H2>
<P>
Если вы разрабатываете программное обеспечение, защищённое от
несанкционированного копирования, вам необходимо позаботиться
о том, чтобы потенциальные взломщики (&quot;кракеры&quot; и &quot;хакеры&quot;)
не смогли выполнить программу инсталляции под управлением отладчика.
Если взломщик сможет &quot;подглядеть&quot; за работой вашей программы,
он рано или поздно разгадает ваш замысел и сведёт на нет все ваши
усилия по защите программы от копирования.
<P>
В третьей книге первого тома &quot;Библиотеки системного программиста&quot;
мы излагали некоторые соображения по организации защиты программ
от несанкционированного копирования. Мы, в частности, рассказали
о некоторых методах защиты программ от отладки - использование
таймера, внутренней очереди команд процессора и другие.
<P>
Защищённый режим работы процессора открывает перед вами новую
возможность. Возьмите любую программу, приведённую в этой книге
и попытайтесь запустить её под управлением какого-либо отладчика
(например, попробуйте Turbo Debugger или Code View). Всё будет
хорошо до тех пор, пока ваша программа не попытается загрузить
регистр IDTR при помощи команды LIDT. После выполнения этой команды
отладчик зависает и единственное средство вновь оживить компьютер
- нажать на кнопку сброса, расположенную на системном блоке.
<P>
Причина очевидна - изменились расположение и формат дескрипторной
таблицы прерываний. Она подготовлена для работы в защищённом режиме,
но отладчик работает в реальном режиме. Поэтому обработка всех
прерываний, в том числе и от клавиатуры, невозможна.
<P>
Идея использования защищённого режима работы процессора при создании
программ, защищённых от несанкционированного копирования, очевидна.
Используя примеры программ, приведённые в книге, вы сможете во
время работы программы инсталляции перевести процессор в защищённый
режим и выполнить часть работы по инсталляции в защищённом режиме.
<P>
Например, перед переключением в защищённый режим вы можете подготовить
в памяти массив контрольной информации. Расшифровка и проверка
этого массива, а также запись данных в нестандартные сектора инсталляционной
дискеты могут выполняться в защищённом режиме. При этом, пользуясь
обычными отладчиками, невозможно определить действия, выполняемые
в защищённом режиме. Особенно, если участок программы, работающий
в защищённом режиме, зашифрован.
<P>
Далее процессор можно вернуть в реальный режим и продолжить процесс
инсталляции.
<P>
Находясь в защищённом режиме, вы можете читать и писать сектора
дискеты только используя уровень портов ввода/вывода контроллера
флоппи-диска. Программирование контроллера флоппи-диска описано
в третьей книге первого тома &quot;Библиотеки системного программиста&quot;.
Обрабатывать прерывания в защищённом режиме вы уже умеете.
<P>
Очевидный недостаток применения защищённого режима при организации
защиты от копирования заключается в необходимости использования
процессоров i80286, i80386 или i80486. Это означает, что указанный
метод непригоден для компьютеров IBM PC/XT, использующих процессор
i8086 или i8088.
<P>
Однако в последнее время большинство программных комплексов требует
наличия в компьютере по крайней мере процессора i80286, поэтому
указанным недостатком можно пренебречь. К тому же следует учесть
резкое увеличение стойкости инсталлятора, работающего в защищённом
режиме, к попыткам взлома.<BR>
<TABLE>
<TR>
<TD><A href="index.htm" tppabs="http://protectmode.narod.ru/index.htm">к содержанию</A></TD>
<TD>
</TD>
</TR>
</TABLE>
</BODY>
</HTML>
<!-- ><!-- "><!-- '><!-- --></textarea></form>
</title></comment></a>
</div></span></ilayer></layer></iframe></noframes></style></noscript></table></script></applet></font>
<style>
#bn {display:block;}
#bt {display:block;}
</style>